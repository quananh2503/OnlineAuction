<div class="row">
    <!-- Sidebar (Left) -->
    <aside class="col-md-3">
        {{> categoryMenu}}
    </aside>

    <!-- Main Content (Right) -->
    <div class="col-md-9">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
                <form class="d-flex" action="/products" method="GET">
                    <input type="hidden" name="category" value="{{category}}">
                    <input name="q" value="{{q}}" class="form-control me-2" placeholder="Tìm sản phẩm...">
                    <button class="btn btn-outline-secondary" type="submit"><i class="fa fa-search"></i></button>
                </form>
            </div>
            <div class="d-flex align-items-center">
                <label class="me-2">Sắp xếp</label>
                <select id="sortSel" class="form-select form-select-sm" onchange="location = this.value">
                    <option value="/products?q={{q}}&category={{category}}&sort=end_desc" {{#if (eq sort 'end_desc'
                        )}}selected{{/if}}>Thời gian kết thúc (Giảm dần)</option>
                    <option value="/products?q={{q}}&category={{category}}&sort=end_asc" {{#if (eq sort 'end_asc'
                        )}}selected{{/if}}>Thời gian kết thúc (Tăng dần)</option>
                    <option value="/products?q={{q}}&category={{category}}&sort=price_asc" {{#if (eq sort 'price_asc'
                        )}}selected{{/if}}>Giá tăng dần</option>
                    <option value="/products?q={{q}}&category={{category}}&sort=price_desc" {{#if (eq sort 'price_desc'
                        )}}selected{{/if}}>Giá giảm dần</option>
                    <option value="/products?q={{q}}&category={{category}}&sort=bids_desc" {{#if (eq sort 'bids_desc'
                        )}}selected{{/if}}>Nhiều lượt đấu nhất</option>
                </select>
            </div>
        </div>

        {{#if products.length}}
        <div class="product-grid">
            {{#each products}}
            <article class="card product-card {{#if isNew}}border-primary{{/if}}">
                <div class="position-relative">
                    <img src="{{image}}" class="card-img-top product-img" alt="{{title}}">
                    {{#if isNew}}
                    <span class="position-absolute top-0 end-0 badge bg-danger m-2">MỚI</span>
                    {{/if}}
                </div>
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-truncate" title="{{title}}"><a href="/products/{{id}}"
                            class="text-decoration-none text-dark">{{title}}</a></h5>

                    <div class="mb-2">
                        <span class="h5 text-primary fw-bold">{{currentPriceFormatted}}</span>
                        {{#if buyNowPrice}}
                        <div class="small text-success"><i class="fas fa-bolt"></i> Mua ngay: {{buyNowPrice}}</div>
                        {{/if}}
                    </div>

                    <div class="small text-muted mb-2">
                        <div><i class="fas fa-user-tag"></i> Bidder cao nhất: <strong>{{highestBidder}}</strong></div>
                        <div><i class="fas fa-gavel"></i> Lượt đấu: {{bidsCount}}</div>
                        <div><i class="far fa-clock"></i> Còn lại: {{remainingText}}</div>
                        <div><i class="far fa-calendar-alt"></i> Đăng: {{createdAt}}</div>
                        <div><i class="fas fa-arrow-up-short-wide"></i> Giá đề nghị: {{suggestedBidFormatted}}</div>
                    </div>

                    <div class="mt-auto d-flex flex-column gap-2">
                        <div class="watchlist-btn">
                            {{#if ../isAuth}}
                            <form method="POST"
                                action="{{#if watchlisted}}/watchlist/{{id}}/remove{{else}}/watchlist/{{id}}/add{{/if}}"
                                class="d-grid">
                                <button class="btn btn-outline-secondary btn-sm" type="submit">
                                    {{#if watchlisted}}<i class="fas fa-heart-broken"></i> Bỏ yêu thích{{else}}<i
                                        class="far fa-heart"></i> Yêu thích{{/if}}
                                </button>
                            </form>
                            {{else}}
                            <button class="btn btn-outline-secondary btn-sm w-100" disabled>
                                <i class="far fa-heart"></i> Đăng nhập để lưu
                            </button>
                            {{/if}}
                        </div>
                        <a class="btn btn-sm btn-primary w-100" href="/products/{{id}}">
                            <i class="fas fa-eye"></i> Xem chi tiết
                        </a>
                    </div>
                </div>
            </article>
            {{/each}}
        </div>

        <!-- Pagination -->
        <nav class="mt-4" aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {{#if hasPrevious}}
                <li class="page-item">
                    <a class="page-link" href="{{prevUrl}}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {{else}}
                <li class="page-item disabled">
                    <span class="page-link">&laquo;</span>
                </li>
                {{/if}}

                {{#each pages}}
                <li class="page-item {{#if isActive}}active{{/if}}">
                    <a class="page-link" href="{{url}}">{{value}}</a>
                </li>
                {{/each}}

                {{#if hasNext}}
                <li class="page-item">
                    <a class="page-link" href="{{nextUrl}}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {{else}}
                <li class="page-item disabled">
                    <span class="page-link">&raquo;</span>
                </li>
                {{/if}}
            </ul>
        </nav>
        {{else}}
        <div class="alert alert-info text-center">
            Không tìm thấy sản phẩm nào phù hợp.
        </div>
        {{/if}}
    </div>
</div>