<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-user-check me-2"></i>Yêu cầu đăng ký Bidder</h2>
            <div>
                <span class="badge bg-warning text-dark">{{pendingCount}} chờ duyệt</span>
            </div>
        </div>

        {{#if success_msg}}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>{{success_msg}}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {{/if}}

        {{#if error_msg}}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>{{error_msg}}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {{/if}}

        {{! Tabs }}
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" 
                        data-bs-target="#pending" type="button" role="tab">
                    Chờ duyệt <span class="badge bg-warning text-dark ms-2">{{pendingCount}}</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="approved-tab" data-bs-toggle="tab" 
                        data-bs-target="#approved" type="button" role="tab">
                    Đã duyệt <span class="badge bg-success ms-2">{{approvedCount}}</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" 
                        data-bs-target="#rejected" type="button" role="tab">
                    Từ chối <span class="badge bg-danger ms-2">{{rejectedCount}}</span>
                </button>
            </li>
        </ul>

        {{! Tab Content }}
        <div class="tab-content">
            {{! Pending Requests }}
            <div class="tab-pane fade show active" id="pending" role="tabpanel">
                {{#if pendingRequests.length}}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th width="50">ID</th>
                                <th>Tên người dùng</th>
                                <th>Email</th>
                                <th width="150" class="text-center">Điểm đánh giá</th>
                                <th width="150">Ngày yêu cầu</th>
                                <th width="200" class="text-center">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each pendingRequests}}
                            <tr>
                                <td>{{this.id}}</td>
                                <td>
                                    <strong>{{this.name}}</strong>
                                </td>
                                <td>{{this.email}}</td>
                                <td class="text-center">
                                    <span class="badge bg-info">{{this.rating}}</span>
                                </td>
                                <td>{{this.requestDate}}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-success me-1 approve-btn" 
                                            data-user-id="{{this.id}}" 
                                            data-user-name="{{this.name}}"
                                            title="Chấp nhận">
                                        <i class="fas fa-check"></i> Duyệt
                                    </button>
                                    <button class="btn btn-sm btn-danger reject-btn" 
                                            data-user-id="{{this.id}}" 
                                            data-user-name="{{this.name}}"
                                            title="Từ chối">
                                        <i class="fas fa-times"></i> Từ chối
                                    </button>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">Không có yêu cầu nào đang chờ duyệt</h5>
                </div>
                {{/if}}
            </div>

            {{! Approved Requests }}
            <div class="tab-pane fade" id="approved" role="tabpanel">
                {{#if approvedRequests.length}}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th width="50">ID</th>
                                <th>Tên người dùng</th>
                                <th>Email</th>
                                <th width="150" class="text-center">Điểm đánh giá</th>
                                <th width="150">Ngày duyệt</th>
                                <th width="150">Người duyệt</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each approvedRequests}}
                            <tr>
                                <td>{{this.id}}</td>
                                <td>
                                    <strong>{{this.name}}</strong>
                                    <span class="badge bg-success ms-2">Bidder</span>
                                </td>
                                <td>{{this.email}}</td>
                                <td class="text-center">
                                    <span class="badge bg-success">{{this.rating}}</span>
                                </td>
                                <td>{{this.approvedDate}}</td>
                                <td>{{this.approvedBy}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="text-center py-5">
                    <i class="fas fa-check-circle fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">Chưa có yêu cầu nào được duyệt</h5>
                </div>
                {{/if}}
            </div>

            {{! Rejected Requests }}
            <div class="tab-pane fade" id="rejected" role="tabpanel">
                {{#if rejectedRequests.length}}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th width="50">ID</th>
                                <th>Tên người dùng</th>
                                <th>Email</th>
                                <th width="150" class="text-center">Điểm đánh giá</th>
                                <th width="150">Ngày từ chối</th>
                                <th width="150">Người từ chối</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each rejectedRequests}}
                            <tr>
                                <td>{{this.id}}</td>
                                <td>{{this.name}}</td>
                                <td>{{this.email}}</td>
                                <td class="text-center">
                                    <span class="badge bg-danger">{{this.rating}}</span>
                                </td>
                                <td>{{this.rejectedDate}}</td>
                                <td>{{this.rejectedBy}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="text-center py-5">
                    <i class="fas fa-times-circle fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">Chưa có yêu cầu nào bị từ chối</h5>
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</div>
{{! Modal Approve }}
<div class="modal fade" id="approveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="approveForm" method="POST">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Xác nhận duyệt</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-0">Bạn có chắc chắn muốn duyệt yêu cầu của <strong id="approveName"></strong> trở thành Bidder?</p>
                    <p class="text-success mb-0 mt-2">
                        <i class="fas fa-info-circle me-1"></i>Người dùng sẽ được phép đăng bán sản phẩm sau khi duyệt.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check me-1"></i>Duyệt
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{{! Modal Reject }}
<div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="rejectForm" method="POST">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="fas fa-times-circle me-2"></i>Xác nhận từ chối</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-2">Bạn có chắc chắn muốn từ chối yêu cầu của <strong id="rejectName"></strong>?</p>
                    <div class="mb-3">
                        <label for="rejectReason" class="form-label">Lý do từ chối (tùy chọn)</label>
                        <textarea class="form-control" id="rejectReason" name="reason" rows="3" 
                                  placeholder="Nhập lý do từ chối..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-times me-1"></i>Từ chối
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Approve modal
    const approveButtons = document.querySelectorAll('.approve-btn');
    const approveModal = new bootstrap.Modal(document.getElementById('approveModal'));
    const approveForm = document.getElementById('approveForm');
    const approveName = document.getElementById('approveName');
    
    approveButtons.forEach(button => {
        button.addEventListener('click', function() {
            const userId = this.dataset.userId;
            const userName = this.dataset.userName;
            
            approveName.textContent = userName;
            approveForm.action = `/admin/bidder-requests/${userId}/approve`;
            
            approveModal.show();
        });
    });

    // Reject modal
    const rejectButtons = document.querySelectorAll('.reject-btn');
    const rejectModal = new bootstrap.Modal(document.getElementById('rejectModal'));
    const rejectForm = document.getElementById('rejectForm');
    const rejectName = document.getElementById('rejectName');
    
    rejectButtons.forEach(button => {
        button.addEventListener('click', function() {
            const userId = this.dataset.userId;
            const userName = this.dataset.userName;
            
            rejectName.textContent = userName;
            rejectForm.action = `/admin/bidder-requests/${userId}/reject`;
            
            rejectModal.show();
        });
    });

    // Auto hide alerts
    setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
});
</script>
</div>
</div>